<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>NeuroScan AI ‚Äî AI Scan</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header class="header">
    <div class="site header-inner">
      <div class="brand">
        <svg xmlns="http://www.w3.org/2000/svg" height="40px" viewBox="0 -960 960 960" width="40px" fill="#e3e3e3"><path d="M390-120q-51 0-88-35.5T260-241q-60-8-100-53t-40-106q0-21 5.5-41.5T142-480q-11-18-16.5-38t-5.5-42q0-61 40-105.5t99-52.5q3-51 41-86.5t90-35.5q26 0 48.5 10t41.5 27q18-17 41-27t49-10q52 0 89.5 35t40.5 86q59 8 99.5 53T840-560q0 22-5.5 42T818-480q11 18 16.5 38.5T840-400q0 62-40.5 106.5T699-241q-5 50-41.5 85.5T570-120q-25 0-48.5-9.5T480-156q-19 17-42 26.5t-48 9.5Zm130-590v460q0 21 14.5 35.5T570-200q20 0 34.5-16t15.5-36q-21-8-38.5-21.5T550-306q-10-14-7.5-30t16.5-26q14-10 30-7.5t26 16.5q11 16 28 24.5t37 8.5q33 0 56.5-23.5T760-400q0-5-.5-10t-2.5-10q-17 10-36.5 15t-40.5 5q-17 0-28.5-11.5T640-440q0-17 11.5-28.5T680-480q33 0 56.5-23.5T760-560q0-33-23.5-56T680-640q-11 18-28.5 31.5T613-587q-16 6-31-1t-20-23q-5-16 1.5-31t22.5-20q15-5 24.5-18t9.5-30q0-21-14.5-35.5T570-760q-21 0-35.5 14.5T520-710Zm-80 460v-460q0-21-14.5-35.5T390-760q-21 0-35.5 14.5T340-710q0 16 9 29.5t24 18.5q16 5 23 20t2 31q-6 16-21 23t-31 1q-21-8-38.5-21.5T279-640q-32 1-55.5 24.5T200-560q0 33 23.5 56.5T280-480q17 0 28.5 11.5T320-440q0 17-11.5 28.5T280-400q-21 0-40.5-5T203-420q-2 5-2.5 10t-.5 10q0 33 23.5 56.5T280-320q20 0 37-8.5t28-24.5q10-14 26-16.5t30 7.5q14 10 16.5 26t-7.5 30q-14 19-32 33t-39 22q1 20 16 35.5t35 15.5q21 0 35.5-14.5T440-250Zm40-230Z"/></svg>
        <span>NeuroScan AI</span>
      </div>

      <nav class="nav">
        <a href="index.html">Home</a>
        <a href="ai-scan.html" class="active">AI Scan</a>
        <a href="insights.html">Dashboard</a>
        <a href="about.html">About & Contact</a>
      </nav>

      <div class="header-right">
        <a class="btn" href="ai-scan.html">Get Started</a>
      </div>
    </div>
  </header>

  <main class="site page">
    <h2 class="page-title">AI Medical Imaging</h2>
    <p class="page-subtitle">Use our validated AI to analyze MRI, CT, or PET images and flag early markers for review.</p>
<!-- 
    <div class="ai-grid">
      <div class="scan-card section">
        <h3>Camera Scan</h3>
        <div class="scan-camera center">
          <div class="camera-icon">üì∑</div>
          <div class="muted small">Camera access required</div>
          <div style="margin-top:12px">
            <button class="btn">Capture Image</button>
          </div>
        </div>
      </div>  -->

      <div class="scan-card section">
        <h4>Upload Medical Images</h4>
        <div class="uploader" style="margin-top:12px; text-align:center;">
        <div id="serviceStatus" class="muted small" style="margin-bottom:8px;">Checking model service‚Ä¶</div>
          
          <!-- Patient Name Input -->
          <div style="margin-bottom:16px;">
            <label for="patientName" style="display:block; margin-bottom:6px; font-weight:500;">Patient Name</label>
            <input 
              id="patientName" 
              type="text" 
              placeholder="Enter patient name" 
              style="padding:10px; border-radius:8px; border:1px solid #444; background:#1a1a1a; color:#fff; width:250px; font-size:14px;"
              required
            >
          </div>

          <input id="file" type="file" accept=".jpg,.png,.jpeg,.dcm" style="display:none">
          <label for="file" class="btn secondary">Upload MRI / CT / PET</label>
          <div style="margin-top:10px;">
            <img id="preview" src="" alt="" style="max-width:200px; display:none; border-radius:8px;">
          </div>
          <button id="analyzeBtn" class="btn" style="margin-top:15px;" disabled>Run AI Analysis</button>
          <div id="loader" class="muted small" style="margin-top:10px; display:none;">‚è≥ Analyzing... please wait</div>
        </div>

        <div style="margin-top:20px" class="muted small">Accepted: .jpg .png .dcm ‚Äî Max 20MB</div>
      </div>
    </div>

    <div class="ai-result section" id="resultBox" style="display:none; margin-top: 40px;">
      <h3>AI Result</h3>
      <p id="patientInfo" class="muted small" style="margin-top:8px; font-weight:bold;"></p>
      <p id="prediction" class="muted small" style="margin-top:8px"></p>
      <p id="confidence" class="muted small" style="margin-top:4px"></p>
    </div>
  </main>

  <footer class="footer site">
    <div class="small muted">2025 NeuroScan AI ‚Äî Empowering clinical decisions</div>
  </footer>

  <script>
    const fileInput = document.getElementById("file");
    const preview = document.getElementById("preview");
    const analyzeBtn = document.getElementById("analyzeBtn");
    const loader = document.getElementById("loader");
    const resultBox = document.getElementById("resultBox");
    const predictionEl = document.getElementById("prediction");
    const confidenceEl = document.getElementById("confidence");
    const patientInfoEl = document.getElementById("patientInfo");
  const serviceStatus = document.getElementById("serviceStatus");

    let selectedFile = null;

    async function checkService() {
      try {
        const resp = await fetch('/api/health');
        if (!resp.ok) throw new Error('Service unreachable');
        const data = await resp.json();
        serviceStatus.textContent = 'Model service: online';
        serviceStatus.style.backdropFilter = 'blur(10px)';
        serviceStatus.style.border = '3px solid green';
        serviceStatus.style.height = 'auto';
        serviceStatus.style.width = '200px';
        serviceStatus.style.backgroundColor = 'rgba(0, 255, 0, 0.1)';
        serviceStatus.style.borderRadius = '8px';
        serviceStatus.style.padding = '8px';
        serviceStatus.style.color = 'green';
        analyzeBtn.disabled = false;
        return true;
      } catch (err) {
        serviceStatus.textContent = `Model service: offline ‚Äî ${err.message}`;
        serviceStatus.style.backdropFilter = 'blur(10px)';
        serviceStatus.style.backgroundColor = 'rgba(255, 0, 0, 0.1)';
        serviceStatus.style.border = '1px solid crimson';
        serviceStatus.style.height = 'auto';
        serviceStatus.style.width = '200px';
        serviceStatus.style.borderRadius = '8px';
        serviceStatus.style.padding = '8px';
        serviceStatus.style.color = 'crimson';
        analyzeBtn.disabled = true;
        return false;
      }
    }

    checkService();

    fileInput.addEventListener("change", (e) => {
      const file = e.target.files[0];
      if (!file) return;
      selectedFile = file;
      preview.style.display = "block";
      preview.src = URL.createObjectURL(file);
      analyzeBtn.disabled = false;
      resultBox.style.display = "none";
    });

    analyzeBtn.addEventListener("click", async () => {
      if (!selectedFile) return alert("Please upload an image first.");

      const patientName = document.getElementById("patientName").value.trim();
      if (!patientName) return alert("Please enter the patient name.");

      loader.style.display = "block";
      analyzeBtn.disabled = true;
      resultBox.style.display = "none";

      const formData = new FormData();
      formData.append("image", selectedFile);
      formData.append("name", patientName);

      try {
        const response = await fetch("/api/predict", {
          method: "POST",
          body: formData
        });
        const data = await response.json();

        loader.style.display = "none";
        resultBox.style.display = "block";
        patientInfoEl.textContent = "üë§ Patient: " + patientName;
        predictionEl.textContent = "üß© " + (data.prediction || "No prediction found.");
        predictionEl.style.fontSize = "30px";
        confidenceEl.textContent = "üìä Confidence: " + ((data.confidence * 100).toFixed(2) || "0") + "%";
      } catch (err) {
        loader.style.display = "none";
        resultBox.style.display = "block";
        predictionEl.textContent = "‚ùå Error: Unable to analyze image.";
        confidenceEl.textContent = "";
      } finally {
        analyzeBtn.disabled = false;
      }
    });
  </script>
</body>
</html>
